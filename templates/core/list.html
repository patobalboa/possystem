{% extends 'core/body.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">

{% endblock %}

{% block content %}
<div class="card card-default">
    

    <div class="card-body">
        {% block add %}
        {% endblock %}
        <hr>

        <table class="table" id="example">
            <thead>
              {% block columns %}
              {% endblock %}
            </thead>
            <tbody>
                {% block rows %}
                {% endblock %}
            </tbody>
          </table>
    </div>

</div>
{% endblock %}

{% block script %}

<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // add datatable to table with id example in django template en spanish.
    $(document).ready(function() {
        $('#example').DataTable({
            "language": {
                "lengthMenu": "Mostrar _MENU_ registros por página",
                "zeroRecords": "No se encontraron resultados en su búsqueda",
                "searchPlaceholder": "Buscar registros",
                "info": "Mostrando registros de _START_ al _END_ de un total de _TOTAL_ registros",
                "infoEmpty": "No existen registros",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "search": "<i class='fas fa-search'></i>",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
            }
        });
        // Añadir al enlace $ ('# btnDelete') un evento click para eliminar el registro con SweetAlert2.
        $('#btnDelete').on('click', function(e) {
            e.preventDefault();
            var deleteUrl = $(this).data('url');        
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¡No podrás revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, ¡bórralo!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: deleteUrl,
                        type: 'POST',
                        data: {'csrfmiddlewaretoken': '{{ csrf_token }}'},
                        dataType: 'json',                
                        success: function (data) {
                            if (data.success) {
                                Swal.fire('Eliminado!', 'El registro a sido eliminado', 'success')
                                .then((result) => {
                                    // redirige a la lista de categorías después de que se ha eliminado la categoría
                                    location.href = '{{ list_url }}';
                                });
                            } else {
                                Swal.fire('Error!', 'Hubo un error al eliminar la categoría.', 'error');
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            Swal.fire('Error!', 'Hubo un error al eliminar la categoría.', 'error');
                        }
                    });
                }
            });
        });

        $('.toggle-btn').on('click', function(e) {
            e.preventDefault();
            var toggleUrl = $(this).data('url');
        
            $.ajax({
                url: toggleUrl,
                type: 'POST',
                data: {'csrfmiddlewaretoken': '{{ csrf_token }}'},
                dataType: 'json',                
                success: function (data) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Exito!',
                        text: 'El estado ha sido cambiado a ' + (data.estado ? 'activo' : 'inactivo'),
                        confirmButtonText: 'Aceptar'
                    }).then((result) => {
                        // redirige a la lista de categorías después de que se ha eliminado la categoría
                        location.href = '{{ list_url }}';
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    Swal.fire('Error!', 'Hubo un error al cambiar el estado.', 'error');
                }
            });
        });
        
    });
    
    
</script>

{% endblock %}