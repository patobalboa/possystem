{% extends 'core/base.html'%}
{% load widget_tweaks %}

{% block content %}
    <form method="post" action=".">
    <div class="card card-default">
        <div class="card-header">
            <!-- Agregar categoria -->
            <h3 class="card-title"><i class="fas fa-plus"></i>
                {{ title }}</h3>
        </div>
        <div class="card-body">
            {% csrf_token %}
            <input type="hidden" name="action" value="{{ action }}">
            {{ form }}
        </div>
        <div class="card-footer">
            <a href='{{ create_url }}' type="submit" class="btn btn-primary">Guardar</a>
            <a class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
    <script type="text/javascript">
        {% if form.errors %}
            var errors = '';
            {% for field in form %}
                {% for error in field.errors %}
                    errors += "{{ error }} \n";
                {% endfor %}
            {% endfor %}
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: errors,
                confirmButtonText: 'Aceptar'
            })
        {% endif %}


        $('form').on('submit', function(e) {
            e.preventDefault();
            var parameters = $(this).serializeArray();
            $.ajax({
                url: '{% url 'core:category_create' %}',
                data: parameters,
                type: 'POST',
                dataType: 'json',
            }).done(function(data) {
                if(!data.hasOwnProperty('error')){
                    Location.href = '{{% list_url %}}';
                    return false;
                }
                message_error(data);
            }).fail(function(jqXHR, textStatus, errorThrown) {
                alert(textStatus + ': ' + errorThrown);
            }).always(function() {
                console.log("complete");
            });
        });

    </script>
{% endblock %}
